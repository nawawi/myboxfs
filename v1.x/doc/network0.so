#!/bin/php
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: network0.so,v 1.00 2003/07/28 1:07 AM nawawi Exp $
//
	include_once('scripts/functions.inc');
	include_once('scripts/auth.inc');
	$_ACCESS=chk_session();
	if($_ACCESS=='' || is_admin($_ACCESS)) {
		write_userlog('Accessing Network -> DNS/Gateway page','Access denied');
		go_exit();
	}
	if(is_admin($_ACCESS)) {
		write_userlog('Accessing Network -> DNS/Gateway page','Access denied -> Not Admin');
		echo "you're on candid camera..";
		exit;
	}
	// Save
	if(isset($do)&& $do=='1') {
		$DNS="$dns1,$dns2,$dns3";
		write_ini('NETWORK','HOSTNAME',$hostname);
		write_ini('NETWORK','DOMAIN',$domain);
		write_ini('NETWORK','NAME_SERVER',$DNS);
		write_ini('NETWORK','GATEWAY',$gateway);
		unset($do,$DNS,$hostname,$domain,$gateway,$dn1,$dns2,$dns3);
		write_userlog('Executing Network -> DNS/Gateway update','Access granted');
		header("Location: network0_msg.so?ref=network0.so");
	}
	if(isset($do)&& $do=='2') {
		unset($do);
		shell_exec("ip route flush cache >/dev/null");
		write_userlog('Executing Network -> DNS/Gateway -> route cache command','Access granted');
		header("Location: network_msg.so?ref=network0.so&msg=Please wait.. clearing route cache");
	}
	$DNS=get_ini('NETWORK','NAME_SERVER');
	$gateway=get_ini('NETWORK','GATEWAY');
	$hostname=get_ini('NETWORK','HOSTNAME');
	$domain=get_ini('NETWORK','DOMAIN');
	list($dns1,$dns2,$dns3)=explode(',',$DNS);
	write_userlog('Accessing Network -> DNS/Gateway page','Access granted');
	write_nocache();
?>
<?include_once('scripts/header.inc');?>
<html>
<head>
<title>MyBox Firewall</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<?include_once('scripts/style.css');?>
<?include_once('scripts/network.js');?>
<?include_once('scripts/global.js');?>
<script language="javascript1.2"><!--
	defaultStatus="DNS/Gateway";
	function dosubmit() {
		var dns1=document.f.dns1.value;
		var dns2=document.f.dns2.value;
		var dns3=document.f.dns3.value;
		var gateway=document.f.gateway.value;
		if(!checkIp(dns1)) return false;
		if(!checkIp(dns2)) return false;
		if(!checkIp(dns3)) return false;
		if(!checkIp(gateway)) return false;
		document.f.submit();
		return true;
	}
	function doclear() {
		location.href='network0.so?do=2';
		return true;
	}
	function dodomain() {
		var host=document.f.hostname.value;
		if(host!='') {
			var domain=domainfromhost(host);
			if(document.f.domain.value=='') document.f.domain.value=domain;
		}
	}
//--></script>
</head>
<body bgcolor="#888888" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onload="initjsDOMenu();">
<!-- start console win -->
<center>
<table bgcolor="#eeeeee" height="100%" width="100%" border="0" cellpadding="0" cellspacing="0" class="block0">
<tr valign="top">
<td align="center">	
<table bgcolor="#005a8f" width="100%" border="0" cellpadding="2" cellspacing="0">
<tr valign="center">
<td height="18" align="left" class="td_label" width=10><img src="png.so?path=image&image=online.gif" border=0 alt="<?get_online();?>"></td>
<td height="18" align="left" class="td_label">&nbsp;Network Configuration - DNS/Gateway</td>
<td height="18" align="right"><a href="blank.so"><img src="png.so?path=image&image=close.png" border="0"></a></td>
</tr>
</table>
<table bgcolor="#d4d0c8" width="100%" height="18" border="0" cellpadding="0" cellspacing="0">
<tr valign="center">
<td>
<form name=e>
<nobr>
<input type=button value="DNS/Gateway" class=input_button onclick="load('network0.so');"><input type=button value="Interfaces Setup" class=input_button onclick="load('network1.so');"><input type=button value="Routing Setup" class=input_button onclick="load('network5.so');"><input type=button value="Host Addresses" class=input_button onclick="load('network2.so');"><input type=button value="ARP Cache" class=input_button onclick="load('network3.so');"><input type=button value="Bandwidth Shaping" class=input_button onclick="load('network4.so');"><input type=button value="Link Failover" class=input_button onclick="load('network6.so');">
</nobr>
</td>
</tr>
<tr><td></form></td></tr>
</table>


<table bgcolor="#eeeeee" width="100%" height="100%" border="0" cellpadding="1" cellspacing="1" class="block">
<tr valign="top">
<td align=center><br><br>


<form name=f action=network0.so?do=1 method=post>
    <table cellpadding="5" border="0" cellspacing="0" align="center">
    <tr>
       <td valign="top" width="250">
            <fieldset>
                <legend>Caching DNS</legend>
                <table border="0" cellspacing="1" cellpadding="0">
                    <tr>
                        <td bgcolor="#E7E9F2">
                            Primary &nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
			<input type="text" name="dns1" size="15" value="<?echo $dns1;?>" class="input_text">
                        </td>
                    </tr>
                    <tr>

                        <td bgcolor="#E7E9F2">
                            Secondary &nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
                            <input type="text" name="dns2" size="15" value="<?echo $dns2;?>" class="input_text">
                        </td>
                    </tr>
                    <tr>

                        <td bgcolor="#E7E9F2">
                            Tertiary &nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
                            <input type="text" name="dns3" size="15" value="<?echo $dns3;?>" class="input_text">
                        </td>
                    </tr>
                   </table>
            </fieldset>
         </td>

        <td valign="top" width="250">
            <fieldset>
                <legend>Routing Gateway</legend>
                <table border="0" cellspacing="1" cellpadding="0">
                    <tr>
                        <td bgcolor="#E7E9F2">
                            Gateway / Router&nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
			<input type="text" name="gateway" size="15" value="<?echo $gateway;?>" class="input_text">
                        </td>
                    </tr>
                    <tr>
                        <td bgcolor="#E7E9F2">
                            Hostname&nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
                            <input type="text" name="hostname" size="15" value="<?echo $hostname;?>" class="input_text" onclick="dodomain()";>
                        </td>
                    </tr>
                    <tr>
                        <td bgcolor="#E7E9F2">
                            Domain&nbsp;&nbsp;&nbsp;&nbsp;
                        </td>
                        <td bgcolor="#E7E9F2">
                            <input type="text" name="domain" size="15" value="<?echo $domain;?>" class="input_text" onclick="dodomain();">
                        </td>
                    </tr>
                   </table>
            </fieldset>
         </td>
    </tr>

    <tr>
        <td colspan="2" align="center">
            <input type="button" value="Cancel" class="input_button" onclick="load('network.so');"><input type="button" value="Clear Route Cache" class="input_button" onclick="return doclear();"><input type="button" value="Save This Setting" class="input_button" onclick="return dosubmit();">
        </td>
    </tr>
    </table>

</form>


</td>
</tr>
</table>

</td>
</tr>
</table>
</center>
<!-- end console win -->
</body>
</html>

<? flush(); ?>

