#!/bin/php
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: download.so,v 1.00 2003/12/05 10.09 PM nawawi Exp $
//

	include_once('scripts/functions.inc');
	include_once('scripts/auth.inc');
	$_ACCESS=chk_session();
	if($_ACCESS=='') {
		write_userlog('Try to download exported file','Access denied');
		go_exit();
	}
	if($handle = opendir("download")) { 
		while(($fl = readdir($handle)) !== false) {  
       			if($fl != "." && $fl != "..") {
				$fddate=date("m",fileatime("download/$fl"));
				$date=date("m",time());
				if($fddate!="$date") {
					if($fl!="index.so") unlink("download/$fl");
				}
       			}	 
  		}
		closedir($handle);
	}
	clearstatcache();
        if((isset($file)&& $file!='') &&(file_exists("download/$file"))) {
		header("Location: /download/$file");
        }
	exit;
?>