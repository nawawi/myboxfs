#!/bin/php -q
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: routing.so,v 1.00 2003/11/23 3:00 AM nawawi Exp $
//
	if(!file_exists('/sbin/route')) {
		syslog(LOG_ERR,'/sbin/route not such file');
		return;
	}
	if(file_exists('functions.inc')) {
		include_once('functions.inc');
	} elseif(file_exists('scripts/functions.inc')) {
		include_once('scripts/functions.inc');
	} else {
		include_once('/usr/miniserv/scripts/functions.inc');
	}
	del_route();
	if(file_exists('/hd/configs/routing.lst')) {
		$file=fopen('/hd/configs/routing.lst','r');
			while(!feof($file)) {
				$ip='';
				$netmask='';
				$gw='';
				$buff=fgets($file,500);
				$buff=trim($buff);
				list($ip,$netmask,$gw)=explode('|',$buff);
				if($buff!='') {
					if($ip!='' && $netmask!='' && $gw!='') {
						shell_exec("/sbin/route add -net $ip netmask $netmask gw $gw >/dev/null 2>&1");
					}
				}
			}
		fclose($file);
		shell_exec("ip route flush cache >/dev/null 2>&1");
	}

?>