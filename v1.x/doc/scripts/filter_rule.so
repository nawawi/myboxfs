#!/bin/php -q
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: filter_rule.so,v 1.00 2003/07/28 1:07 AM nawawi Exp $
//


	set_time_limit(0);

	if(!file_exists('/sbin/iptables')) {
		syslog(LOG_ERR,'/sbin/iptables not such file');
		return;
	}
	if(file_exists('functions.inc')) {
		include_once('functions.inc');
	} elseif(file_exists('scripts/functions.inc')) {
		include_once('scripts/functions.inc');
	} else {
		include_once('/usr/miniserv/scripts/functions.inc');
	}
	if(file_exists('rules.inc')) {
		include_once('rules.inc');
	} elseif(file_exists('scripts/rules.inc')) {
		include_once('scripts/rules.inc');
	} else {
		include_once('/usr/miniserv/scripts/rules.inc');
	}
	do_flush();
	custom_filter();
	webadmin_enable();
	filter_rule();
	forward_rule();
	filter_nat();
	string_rule();
	do_sysctl();
?>
