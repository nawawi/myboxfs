#!/bin/php -q
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: shaper.so,v 1.00 2003/07/28 1:07 AM nawawi Exp $
//
	if(file_exists('/hd/configs/bandwidth.lst')) {
		$line=file('/hd/configs/bandwidth.lst');
		for($x=count($line);$x >= 0;$x--) {
			$buff=$line[$x];
			if($buff!='') {
				list($src,$trans,$que,$desc,$active)=preg_split("/\|/",$buff);
				if($que==0) unset($que);
				if($active==0) {
					shell_exec("/usr/sbin/rshaperctl $src 0");
				} else {
					shell_exec("/usr/sbin/rshaperctl $src $trans $que");
				}
			}
		}
		flush();
	}
?>