#!/bin/php
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: console1.so,v 1.00 2003/07/28 1:07 AM nawawi Exp $
//
	include_once('scripts/functions.inc');
	include_once('scripts/auth.inc');
	$_ACCESS=chk_session();
	if($_ACCESS=='') {
		echo "session expired";
		exit;
	}
	if(isset($cmd) && $cmd!='') {
		$command=$cmd;
		$values=$value;
		$select[$cmd]='selected';
		$c1=$cmd;
		$c2=$value;
		unset($cmd,$value);
	}
	if(isset($do)&& $do==1) {
		$load="onload='do_console();';";
	} elseif(isset($do)&& $do=='stop') {
		shell_exec('sh /etc/init.d/console.sh all >/dev/null 2>&1');
		unset($cmd,$value);
	} else {
		unset($load);
	}
	unset($do);
?>
<?include_once('scripts/header.inc');?>
<html>
<head>
<title>MyBox Firewall - Console</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<?include_once('scripts/style.css');?>
<script language="javascript"><!--
	defaultStatus="Console";
	function do_console() {
		var cmd=document.f.command.value;
		var value=document.f.console.value;
		parent.console_main.location.href='/console2.so?cmd='+cmd+'&value='+value;
		return true;
	}
	function do_stop() {
		var cmd=document.f.command.value;
		var value=document.f.console.value;
		parent.console_top.location.href='/console1.so?do=stop&cmd='+cmd+'&value='+value;
		return true;
	}
	function do_clear() {
		parent.console_main.location.href='/console2.so';
		return true;
	}
//--></script>
</head>
<body bgcolor="#005a8f" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" oncontextmenu="return false" oncontextmenu="return false" scroll=no border=0 <?echo $load;?>>
<center>
<table height="38" width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr valign="top">
		<td valign=middle align=center><form name=f method=post action="info1.so">
		<select name=command class=input_text>
		<option value="ping" <?echo $select['ping'];?>>ping</option>
		<option value="whois" <?echo $select['whois'];?>>whois</option>
		<option value="lookup" <?echo $select['lookup'];?>>dig</option>
		<option value="nbtscan" <?echo $select['nbtscan'];?>>nbtscan</option>
		<option value="traceroute" <?echo $select['traceroute'];?>>traceroute</option>
		<option value="host" <?echo $select['host'];?>>host</option>
		<option value="tcpdump" <?echo $select['tcpdump'];?>>tcpdump</option>
		</select>
		<input type="text" name="console" size="25" value="<?echo $c2;?>" class="input_text" onclick="document.f.console.value='';"> <input type=button value="Command" class="input_text" onclick="return do_console();"> <input type=button value="Stop" class="input_text" onclick="return do_stop();"><input type=button value="Flush" class="input_text" onclick="return do_clear();">
		</td>
	</tr>
</table>
</center>
</body>
</html>

<? flush(); ?>