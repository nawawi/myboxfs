#!/bin/php
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: ids1.so,v 1.00 2003/08/20 9:25 PM nawawi Exp $
//
	include_once('scripts/functions.inc');
	include_once('scripts/auth.inc');
	include_once('scripts/system.inc');
	$_ACCESS=chk_session();
	if($_ACCESS=='' || is_admin($_ACCESS)) {
		write_userlog('Accessing IDS Signatures Info','Access denied');
		go_exit();
	}
	write_nocache();
?>
<?include_once('scripts/header.inc');?>
<html>
<head>
<title>MyBox Firewall</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<?include_once('scripts/style.css');?>
<?include_once('scripts/network.js');?>
<?include_once('scripts/global.js');?>
<script language="javascript1.2"><!--
	defaultStatus="Signature Info";
//--></script>
</head>
<body bgcolor="#888888" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onload="initjsDOMenu();">
<!-- start console win -->
<center>
<table bgcolor="#eeeeee" height="100%" width="100%" border="0" cellpadding="0" cellspacing="0" class="block0">
<tr valign="top">
<td align="center">	
<table bgcolor="#005a8f" width="100%" border="0" cellpadding="2" cellspacing="0">
<tr valign="center">
<td height="18" align="left" class="td_label" width=10><img src="png.so?path=image&image=online.gif" border=0 alt="<?get_online();?>"></td>
<td height="18" align="left" class="td_label">&nbsp;IDS Configuration - Signature Info</td>
<td height="18" align="right"><a href="blank.so"><img src="png.so?path=image&image=close.png" border="0"></a></td>
</tr>
</table>
<table bgcolor="#d4d0c8" width="100%" height="18" border="0" cellpadding="0" cellspacing="0">
<tr valign="center">
<td>
<form name=g>
<nobr>
<input type=button value="Blocking Setup" class=input_button onclick="load('ids0.so');"><input type=button value="Signature Info" class=input_button onclick="load('ids1.so');"><input type=button value="Manage Signatures" class=input_button onclick="load('ids2.so');"></nobr>
</td>
</tr>
<tr><td></form></td></tr>
</table>


<table bgcolor="#eeeeee" width="100%" height="100%" border="0" cellpadding="1" cellspacing="1" class="block">
<tr valign="top">
<td align=center><br><br>

    <table cellpadding="5" border="0" cellspacing="0" align="center">
    <tr>
	<?
		$version=trim(`config -r INFO VERSION /hd/idsconf/info.cnf`);
		$date=`config -r INFO DATE /hd/idsconf/info.cnf`;
	?>
        <td valign="top" width="510" align=center>
            <fieldset>
                <legend>Signature Info</legend><br>
                <table width="80%" border="0" cellspacing="1" cellpadding="0">
                    <tr>
                        <td>
   			<table class="box">
     			<tr class="boxheader">
      			<td class="boxheader">IDS Signatures Information</td>
     			</tr>
     			<tr>
      			<td>
			<table border="0" width="90%" align="center">
			<tr>
			<td valign="top" class=td_tab>Update version</td>
			<td><?echo $version;?></td>
			</tr>
			<tr>
			<td valign="top" class=td_tab>Date compiled</td>
			<td><?echo $date;?></td>
			</tr>
			<tr>
			<td valign="top" colspan=2 class=td_tab><hr size=1>Loaded signatures:</td>
			</tr>
			<tr>
			<td valign="top" colspan=2 class=td_tab>
			<?
			function _get_line($what) {
				$cnt='0';
				$line=file($what);
				foreach($line as $l) {
					$l=trim($l);
					if($l!='') {
						$cnt++;
					}
				}
				return $cnt;
			}
			function _get_size($what) {
				$what1=filesize($what);
				$what1=$what1 / 1024;
				$what1=format_bytesize($what1);
				return "$what1";
			}
			if(file_exists('/hd/idsconf/info.cnf')) {
			echo "<textarea cols=80 rows=8 class=input_text>\n";
			if($handle = opendir("/hd/idsconf/rules")) { 
				while(($fl = readdir($handle)) !== false) {  
       					if($fl != "." && $fl != "..") {
           					if(preg_match("/(.*).sig/",$fl)) {
							$fll=_get_line("/hd/idsconf/rules/$fl");
							$fls=_get_size("/hd/idsconf/rules/$fl");
							echo "-- $fl ------------- ($fll lines / $fls)\n";
						}	 
       					}	 
  				}
				closedir($handle);
			}
			echo "</textarea>";
			}
			clearstatcache();
			?>
			</td>
			</tr>
			</table>
			</td>
     		</tr>
	</td>
  </tr>
</table>


<br><br>
                        </td>
                    </tr>
                   </table>
            </fieldset>
         </td>
    </tr>
    </table>
</td>
</tr>
</table>

</td>
</tr>
</table>
</center>
<!-- end console win -->
</body>
</html>

<? flush(); ?>
