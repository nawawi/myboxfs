#!/bin/php
<?
//
// Mybox Firewall - A Firewall Appliance
// http://www.mybox.net.my/
//
// (C) Copyright 2002,2003,2004 Mohd Nawawi Mohamad Jamili, TraceNetwork Corporation Sdn. Bhd.
//
// This program is not free software; you cannot redistribute it and/or
// modify without permission copyright owner.
//
// This code is protected by copyright law and international treaties. 
// Unauthorized reproduction or distribution of this program, or any portion of it, 
// may result in severe civil and criminal penalties, and will be prosecuted to the 
// maximum extent possible under the law.
//
// $Id: console2.so,v 1.00 2003/07/28 1:07 AM nawawi Exp $
//
	include_once('scripts/functions.inc');
	include_once('scripts/auth.inc');
	$_ACCESS=chk_session();
	if($_ACCESS=='') {
		echo "session expired";
		exit;
	}
	if(isset($cmd) && $cmd!='') {
		$command=$cmd;
		$values=$value;
		$select[$cmd]='selected';
		$c1=$cmd;
		$c2=$value;
		unset($cmd,$value);
	}
?>
<?include_once('scripts/header.inc');?>
<html>
<head>
<title>MyBox Firewall - Console</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<?include_once('scripts/style.css');?>
<script language="javascript"><!--
	defaultStatus="Console";
	function do_scroll() {
	  if (scrolling) window.scroll(1,500000);
	  window.setTimeout("do_scroll()", 100);
	}
  scrolling = true;
  do_scroll();
//--></script>
</head>
<body onfocus="scrolling=false" onblur="scrolling=true;self.focus();" bgcolor="#000000" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" oncontextmenu="return false" oncontextmenu="return false" border=0>
<pre class=pre_tab>
<?
	ini_set('output_buffering','0');
	if(isset($command) && $command!='') {
		switch($command) {
			case 'ping':
				$values=preg_replace("/[^A-Za-z0-9.]/","",$values);
				$ping=popen("ping $values",'r');
				while($buff=fgets($ping)) {
					echo "$buff";
					flush();
				}
				pclose($ping);
				break;
			case 'whois':
				$values=preg_replace("/[^A-Za-z0-9.]/","",$values);
				$whois=popen("whois $values",'r');
				while($buff=fgets($whois)) {
					echo "$buff";
					flush();
				}
				pclose($whois);
				break;
			case 'lookup':

				$values=preg_replace("/[^A-Za-z0-9.]/","",$values);
				$dig=popen("dig $values",'r');
				while($buff=fgets($dig)) {
					echo "$buff";
					flush();
				}
				pclose($dig);
				break;
			case 'nbtscan':
				$values=preg_replace("/\|/","",$values);
				$values=gethostbyname($values); 
				$nbtscan=popen("nbtscan -r -q $values",'r');
				while($buff=fgets($nbtscan)) {
					echo "$buff";
					flush();
				}
				pclose($nbtscan);
				break;
			case 'traceroute':
				$values=preg_replace("/[^A-Za-z0-9.]/","",$values);
				$trace=popen("traceroute $values",'r');
				while($buff=fgets($trace)) {
					echo "$buff";
					flush();
				}
				pclose($trace);
				break;
			case 'host':
				$values=preg_replace("/[^A-Za-z0-9.]/","",$values);
				$host=popen("host $values",'r');
				while($buff=fgets($host)) {
					echo "$buff";
					flush();
				}
				pclose($host);
				break;
			case 'tcpdump':
				$values=preg_replace("/\|/","",$values);
				$host=popen("tcpdump $values",'r');
				while($buff=fgets($host)) {
					if($buff!='') echo "$buff";
					flush();
				}
				pclose($host);
				break;

		} 
	} 
?>
</pre>
</body>
</html>

<? flush(); ?>